<title>WebGL test</title>
<link rel="stylesheet" href="../style.css">

<script type="module">

import { mat4 } from '../lib/gl-matrix.js';
import { GLCanvas } from '../src/common/GLCanvas.js';
import * as ShaderCommon from '../src/common/ShaderCommon.js';

const canvas = new GLCanvas();

const viewMatrix = mat4.lookAt(
  mat4.create(),
  [ 0, 0, 5 ],
  [ 0, 0, 0 ],
  [ 0, 1, 0 ],
);


const SquarePoints = [
  0.5,  0.5, 
 -0.5,  0.5, 
  0.5, -0.5, 
 -0.5, -0.5,
];

const vertices = [
  //Front
  -0.5, -0.5, -0.5,
    0.5, -0.5, -0.5,
    0.5,  0.5, -0.5,
  -0.5,  0.5, -0.5,
  //Back
    0.5, -0.5, 0.5,
  -0.5, -0.5, 0.5,
  -0.5,  0.5, 0.5,
    0.5,  0.5, 0.5
];

const indices = [
  0, 1, 2, //front
  0, 2, 3,
  1, 4, 7, //right
  1, 7, 2,
  4, 5, 6, //back
  4, 6, 7,
  5, 0, 3, //left
  5, 3, 6,
  3, 2, 7, //top
  3, 7, 6,
  0, 1, 5, //bottom
  1, 4, 5
];

const ShaderInfo = {
  Square: {
    vertexShader: ShaderCommon.CommonVertexShader,
    fragmentShader: ShaderCommon.CommonFragmentShader,
    attributes: ShaderCommon.CommonAttributes,
    uniforms: ShaderCommon.CommonUniforms,
    vertices: vertices,
    indices: indices,
  },
};

const shader = ShaderCommon.getShader( canvas.gl, ShaderInfo.Square );

const squareMatrix = mat4.fromRotationTranslationScale( 
  mat4.create(), 
  [ 0, 0, 0, 0 ],
  [ 0, 0, 0 ],
  [ 1, 1, 1 ],
);

let angle = 0;

canvas.update = ( dt ) => {
  angle += dt / 1000;

  mat4.fromRotationTranslationScale(
    squareMatrix,
    [ Math.cos( angle / 2 ), 0, Math.sin( angle / 2 ), 0 ],
    [ 0, 0, 0 ],
    [ 1, 1, 1 ],
  )
}

const projectionMatrix = mat4.create();

canvas.draw = ( gl ) => {

  const fieldOfView = 45 * Math.PI / 180; // in radians
  const zNear = 0.1;
  const zFar = 100.0;
  mat4.perspective( projectionMatrix, fieldOfView, canvas.canvas.width / canvas.canvas.height, zNear, zFar );


  const mv = mat4.multiply( mat4.create(), projectionMatrix, viewMatrix );

  gl.useProgram( shader.program );

  gl.uniformMatrix4fv( shader.uniformLocations.mvp, false, 
    mat4.multiply( mat4.create(), mv, squareMatrix )
  );

  gl.uniform3fv( shader.uniformLocations.color, [ 1.0,  0.65, 0.0  ] );

  ShaderCommon.drawPoints( gl, shader );
}

canvas.start();

</script>