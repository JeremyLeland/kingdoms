<title>ThreeJS test</title>
<link rel="stylesheet" href="../style.css">

<script type="module">
  import * as THREE from '../lib/threejs/three.module.js';
  import { ThreeGame } from '../src/common/ThreeGame.js';
  import { OrbitControls } from '../lib/threejs/OrbitControls.js';
  import { ValuesPanel } from '../src/common/ValuesPanel.js';

  const Person = {
    HeadSize: 0.4,
    Neck: 0.2,
    BodyWidth: 0.5,
    BodyHeight: 1.5,
    CarryDown: 0.5,
    CarryAway: 0.1,
  }

  new ValuesPanel( Person );

  const game = new ThreeGame();
  game.scene.background = new THREE.Color( 0x000022 );
  game.camera.position.set( 5, 5, 5 );
  game.camera.lookAt( 0, 0, 0 );

  const controls = new OrbitControls( game.camera, game.renderer.domElement );
  controls.target.set( 0, 0, 0 );
  // controls.minDistance = 1;
  // controls.maxDistance = 10;
  controls.update();


  game.scene.add( new THREE.AxesHelper( 5 ) );

  const grid = new THREE.GridHelper( 10, 10 );
  grid.material.opacity = 0.2;
  grid.material.transparent = true;
  game.scene.add( grid );

  game.scene.add( new THREE.AmbientLight( 0xffffff, 0.4 ) );

  const light = new THREE.DirectionalLight( 0xffffff, 0.8 );
  light.position.set( 0, 1, 1 );
  light.target.position.set( 0, 0, 0 );
  game.scene.add( light );

  const group = new THREE.Group();
  
  const body = new THREE.Mesh( 
    new THREE.SphereGeometry( 1, 32, 32, 0, Math.PI * 2, 0, Math.PI / 2 ), 
    new THREE.MeshPhongMaterial( { color: 'green' } ),
  );
  group.add( body );

  const head = new THREE.Mesh( 
    new THREE.SphereGeometry( 1, 32, 32 ), 
    new THREE.MeshPhongMaterial( { color: 'tan' } ),
  );
  group.add( head );

  const wood = new THREE.Mesh(
    new THREE.BoxGeometry( 1, 0.1, 0.2 ),
    new THREE.MeshPhongMaterial( { color: 'brown' } ),
  )

  group.add( wood );

  game.scene.add( group );


  const DURATION = 1000;

  let animationTime = 0;

  game.start( ( dt ) => {
    animationTime += dt;

    const bodyHeight = Person.BodyHeight - 0.25 * Math.sin( Math.PI * 2 * ( animationTime % DURATION ) / DURATION );

    body.scale.set( Person.BodyWidth, bodyHeight, Person.BodyWidth );

    head.scale.set( Person.HeadSize, Person.HeadSize, Person.HeadSize ); 
    head.position.set( 0, bodyHeight + Person.HeadSize - Person.Neck, 0 );

    wood.position.set( 0, bodyHeight - Person.CarryDown, Person.BodyWidth + Person.CarryAway );

    const WALK_RADIUS = 3, WALK_TIME = 12000;
    const theta = Math.PI * 2 * ( animationTime % WALK_TIME ) / WALK_TIME;

    group.position.set( WALK_RADIUS * Math.cos( theta ), 0, WALK_RADIUS * Math.sin( theta ) );
    group.rotation.set( 0, -theta, 0 );

  } );

</script>
